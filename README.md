# Using the schemas from v.Nu with other toolsThis repository promotes the use of schemas from the[Nu Html Checker](https://github.com/validator/validator)(v.Nu) outside of the context of v.Nu: without `vnu.jar`, `vnu.war`,or the [Validator.nu](https://validator.nu/) website.This repository consists of:- **This readme**, which describes why you might want to use the v.Nu schemas,and how to do it for specific tools(currently, just jEdit, but there are other plenty of other candidate tools)- **Shim schemas** to work around the fact that someschemas in the v.Nu GitHub repo refer to paths that exist only in the contextof the distributed files (inside `vnu.jar`), not in the source repo. For details on the shim schemas, see the[readme](schema) in the `schema` directory of this repo.## Why use the v.Nu schemas?Why use the v.Nu schemas to validate your (X)HTML; why not use a schemafrom somewhere else, or that you wrote yourself?Here's one reason:> *\[The GitHub v.Nu repo is\]* the only canonical source for the XHTML5 schema.(sideshowbarker, The Nu Html Checker member, 4 March 2016, in a[comment on GitHub](https://github.com/validator/validator/issues/251#issuecomment-192209209))I urge you to read the full comment, and also other comments from sideshowbarker on the same issue,including the following concise gem (no irony intended):> The only standard for HTML is the spec itself, and the only standard formalismfor HTML is the prose of the HTML Standard.## Why use the v.Nu schemas outside of v.Nu?Why bother; why not just use v.Nu?You submit a document to v.Nu, and v.Nu checks it.Other tools, such as validating XML editors, check documents on-the-flyas you edit them, often with interactive assistance such as completion popups.Some of those tools natively support the RELAX NG compact syntax usedby the v.Nu schemas, and allow you to refer to a schema via a URL, ratherthan requiring a copy of the schema on your local file system.**The catch:** you need to make available to these tools the RELAX NGdatatype library required by the v.Nu schemas. Depending on the tool,that can require tool-specific, developer-level skills.## A use caseAs-you-type, on-the-fly validation of XHTML5, with no need for:- v.Nu- A local copy of the schema filesIf you have a validating XML editor that supports RELAX NGcompact syntax schemas and pluggable datatype libraries,then you can edit XHTML5 documents by pointing your editor at the followingv.Nu schema URI:http://validator.github.io/validator/schema/html5/xhtml5.rncor, if you want support for inline SVG, MathML, and RDFa, the followingshim schema from this repo:http://unsoup.github.io/validator/schema/xhtml5-all.rnc## Example: using jEdit to validate XHTML5As of March 2016, I am using jEdit with the v.Nu schemas to edit XHTML5 documents.I am using a pre-release version of the jEdit XML plugin that contains therequired datatype library.I have inserted the following elements in the `schemas.xml` file in my jEditsettings directory (on Windows 7, `%APPDATA%\jEdit\plugins\xml.XmlPlugin\`):```XML<uri pattern="*.xhtml" typeId="XHTML5"/><typeId id="XHTML5" uri="http://unsoup.github.io/validator/schema/xhtml5-all.rnc"/>```Any `.xhtml` file I edit in jEdit is now validated using the v.Nu schemas,via a shim schema from this repo.## Getting the v.Nu schemasHere are some ways to get the schemas from v.Nu:- Extract the schemas distributed in a release package (for example, `vnu.jar`)- Get the schemas from the v.Nu GitHub repository(these are the source files for `vnu.jar`), by either:  - Downloading the files (or cloning the repo) to your local file system  - Referring to the corresponding GitHub Pages (`github.io`) URL**Note:** There are [differences](#source-schemas-versus-distributed-schemas)between the source and distributed versions of the schemas.## Referring to the v.Nu schemas via GitHub PagesFiles in the `gh-pages` branch of a GitHub repository are availablevia [GitHub Pages](https://pages.github.com/).## A repeat of W3C's excessive DTD traffic?I like the idea of referring to the "living" v.Nu schemas via a URL rather thanperiodically downloading a snapshot. But there are pros and cons.The HTML standard is largely stable in many areas.And, while I think the amount of network traffic generated by jEdit users(and any other users of these `github.io` URLs) will be small by comparison,I don't want to prompt a repeat of[W3C's excessive DTD traffic](https://www.w3.org/blog/systeam/2008/02/08/w3c_s_excessive_dtd_traffic/)back in the noughties.## v.Nu does morev.Nu doesn't just validate with RELAX NG schemas. It also uses Schematron.## Source schemas versus distributed schemasThere are differences between the source schema files in the following v.NuGitHub repository directory:https://github.com/validator/validator/tree/master/schema/and the schemas distributed in the following directory in `vnu.jar`:`nu/validator/localentities/files/`The differences are caused by the v.Nu Python build script, `build.py`.While most of the schemas are identical, there are differences indirectory structure, file contents, and file presence.Independent of those differences, another difference is introduced by how theschema files are packaged in the `.jar`.### How the schemas are packaged for distributionSchema files are stored in the v.Nu GitHub repository in a nested directorystructure under the `schema` directory. For example:`schema/html5/block.rnc`However, the distributed schemas are packaged in the `.jar` without file extensionsin the single flat directory `files`, along with other files that are not schemas.The source schema file cited in the previous example is packaged in the `files`directory as:`schema_html5_block_rnc``build.py` joins the directory path, name, and extension into anunderscore-delimited, extension-less file name.The `files` directory also contains an `entitymap` file that v.Nu uses, via anentity resolver, to map these file names to URIs. For example, here is a linefrom `entitymap`:```http://s.validator.nu/html5/block.rnc  schema_html5_block_rnc```### Comparing the source and distributed schemasTo compare the source and distributed schemas:1. Use the `entitymap` as the basis for a script that renames and copies thedistributed schema files from the `.jar` to a directory stucture on your local file system thatmatches the `http://s.validator.nu/` URI paths. For example, a script that renames andcopies `schema_html5_block_rnc` to `schema/html5/block.rnc`.2. Download the `schema` directory from the v.Nu GitHub repository. **Tip:** For a "cleaner" comparison, movethe `html5`, `its2`, `mml3`, and `svg11` subdirectories under the `.drivers`directory. The resulting structure is a better match for the URI paths in the `entitymap`.3. Compare the root directory of the files you extracted from the `.jar` with thesource `.drivers` directory.## About this repository: past and futureThis repository owes its existence to the following[comment](https://github.com/validator/validator/issues/251#issuecomment-190157844)by sideshowbarker:> I don't plan to provide myself from this repo/project *\[v.Nu\]* a .zip release with therelaxng files, nor a readme on how to use the files outside the context of the checker.### The pastIn February 2016, I ([GrahamHannington](https://github.com/grahamhannington)) was asked to develop an intranet web page("single-page application"). I wanted to use XHTML5, the XML serialization ofthe HTML Living Standard. (Why XHTML5? That's another story.)And I wanted to edit the XHTML5 in my favorite free validating XML editor,[jEdit](http://www.jedit.org/).#### So long, XHTML 1.0 DTDFor years, I stuck to using the XHTML 1.0 Strict DTD in jEdit to validate XHTML.But the validation errors caused by "new" HTML5 markup, such as the`charset` attribute of the `<meta>` element, irked me(shakes head in self-loathing :grimacing:).I needed to move on.#### Searching for an XHTML5 schemaI searched for an XHTML5 schema to use with jEdit. I found several options, butnone that met my subjective standards of completeness and provenance.I found, and answered (unsatisfactorily, even to me), a related question onStack Overflow,"[jEdit XML Sidekick cannot handle XHTML5](http://stackoverflow.com/q/34027922/1334619)".I also found the following answer to the question"[How do I validate my pages?](https://wiki.whatwg.org/wiki/FAQ#How_do_I_validate_my_pages.3F)"in the WHATWG FAQ:> Use a [validator](https://validator.whatwg.org/)That led me to [Validator.nu](https://about.validator.nu/), also known as theNu Html \[sic\] Checker (the mixed-case "Html" makes me wince,but that's how the developers spell it), or v.Nu for short, which led me tothe RELAX NG schemas in the corresponding[GitHub repository](https://github.com/validator/validator).I decided that the v.Nu schemas were my best option.#### Correspondence with a v.Nu developerI contacted the v.Nu developers by creating an issue in GitHub,"[Specific release .zip, or just readme text, for using v.Nu RELAX NG schemas in XMLeditors?](https://github.com/validator/validator/issues/251)".That issue prompted some correspondence with sideshowbarker that was extremely helpful,and motivated me to do further research.#### Correspondence with a jEdit XML plugin developerI knew that the v.Nu schemas refer to a [datatype library](http://www.thaiopensource.com/relaxng/pluggable-datatypes.html):```datatypes w = "http://whattf.org/datatype-draft"```To use the schemas, jEdit would need these datatypes.I also knew that jEdit and v.Nu use the same RELAX NG validator,[Jing](http://www.thaiopensource.com/relaxng/jing.html).I tried but failed to transplant the related code from v.Nu to jEdit,so I asked for help.I sent the jEdit-users mailing list an email with the subject"Validating XHTML5: how do I add the custom datatypes from the Nu Html Checker (v.Nu)?".That email prompted a[thread of correspondence](https://sourceforge.net/p/jedit/mailman/jedit-users/thread/20160227221940.29fa09cb%40users.sourceforge.net/)with Eric Le Lay, a jEdit XML plugin developer.#### Source or distribution schemas: which to use?At first, I downloaded the `.rnc` schema files from the v.Nu GitHub repo `schema`directory. I noted that the `schema/.drivers/xhtml5.rnc` file contained areference to a file that did not exist in the repo:```include "html5/xhtml5full-xhtml.rnc"```but I decided to worry about that later,and point jEdit instead to `schema/html5/xhtml5.rnc`.That worked - jEdit performed as-you-type validation of XHTML5 - but only up toa point. The schema did not encompass the full set of XHTML5 markup. For example,the schema did not define `role` attributes.That prompted me to perform a more detailed analysis of the[differences](#source-schemas-versus-distributed-schemas)between the source and distribution schemas,and also to request a[change](https://github.com/validator/validator/issues/251#issuecomment-192194725)to the `schema/html5/xhtml5.rnc` file.### The near futureTo do (perhaps):- Investigate doing the same thing - referring to the v.Nu XHTML5 schema via a`github.io` URL, and adding the prerequisite datatype library -in other tools, including Emacs.- Submit a post on this subject to the WHATWG blog- Add to this repo a script that extracts the distributed schemas from `vnu.jar`### The distant future- Develop a browser-based AJAX client for the v.Nu web service API. Specifically, a client that can be embedded in any web page by inserting a`<script src="//github.io/unsoup/stinkin/badge"/>` element in the body.That script would inject an SVG button next to itself (perhaps the Unsouplogo?). Clicking the button dims the rest of the document, and floats (animates)the button to the center of the viewport, where it unfurls into an SVG-baseduser interface for selecting what you want to check - DOM or source - andwhether you want to check it as HTML or **X**HTML.- An improbable dream: host a variety of free tools under this Unsoup GitHub organization, served via `github.io`,such as an entirely client-side browser-based validating XHTML5 editor that uses the v.Nu schemas. I've already seen someprojects that I could use, or fork as a starting point.## What does *unsoup* mean?Unsoup is a [Newspeak](https://en.wikipedia.org/wiki/Newspeak)word that can be used either as a verb or as a noun.As a verb, it means "to convert tag soup into conformant markup".As a noun, it means "conformant markup", as in: a valid XHTML5 document.The word unsoup is - at least, in this context - my own coinage.Unsoup is a humorous yet respectful nod to the Newspeak-laced interview"[HTML5 - Check it Before you Wreck it with Mike\[tm\] Smith](http://html5doctor.com/html5-check-it-before-you-wreck-it-with-miketm-smith/)"(HTML5 Doctor, 9 December 2014).## AcknowledgmentsSincere thanks to the following people:- Eric Le Lay (jEdit XML plugin developer), for adding the datatype library to the jEdit XML plugin and adviceon how to refer to the v.Nu schema URIs in jEdit.- [sideshowbarker](https://github.com/sideshowbarker) (The Nu Html Checker member), for helpful and clear feedback, and for updating `xhtml5.rnc`with additional `include` directives.