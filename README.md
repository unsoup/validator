# Using the schemas from v.Nu with other toolsThis repository discusses using the schemas from the[Nu Html Checker](https://github.com/validator/validator)(v.Nu) outside of the context of v.Nu (without `vnu.jar` or `vnu.war`).## "Discusses"? Is that all? Seriously?Yes. Right now, this repo is just a readme.## A use caseAs-you-type validation of XHTML5, with no need for:- v.Nu (`vnu.jar` or `vnu.war`)- A local copy of the schema filesIf you have a validating XML editor that supports RELAX NGcompact syntax schemas and pluggable datatype libraries,then you can edit XHTML5 documents by pointing your editor at the followingv.Nu schema URI:http://validator.github.io/validator/schema/html5/xhtml5.rnc## The pastIn February 2016, I ([GrahamHannington](https://github.com/grahamhannington)) was asked to develop an intranet web page("single-page application"). I wanted to use XHTML5, the XML serialization ofthe HTML Living Standard. (Why XHTML5? That's another story.)And I wanted to edit the XHTML5 in my favorite free validating XML editor,[jEdit](http://www.jedit.org/).### So long, XHTML 1.0 DTDFor years, I stuck to using the XHTML 1.0 Strict DTD in jEdit to validate XHTML.But the validation errors caused by "new" HTML5 markup, such as the`charset` attribute of the `<meta>` element, was reallystarting to get to me (shakes head in self-loathing :grimacing:).I needed to move on.### Searching for an XHTML5 schemaI searched for an XHTML5 schema to use with jEdit. I found several options, butnone that met my subjective standards of completeness and provenance.I found, and answered (unsatisfactorily, even to me), a related question onStack Overflow,"[jEdit XML Sidekick cannot handle XHTML5](http://stackoverflow.com/q/34027922/1334619)".I also found the following answer to the question"[How do I validate my pages?](https://wiki.whatwg.org/wiki/FAQ#How_do_I_validate_my_pages.3F)"in the WHATWG FAQ:> Use a [validator](https://validator.whatwg.org/)That led me to [Validator.nu](https://about.validator.nu/), also known as theNu Html \[sic\] Checker (the mixed-case "Html" makes me wince,but that's how the developers spell it), or v.Nu for short, which led me tothe RELAX NG schemas in the corresponding[GitHub repository](https://github.com/validator/validator).I decided that the v.Nu schemas were my best option.### Correspondence with a v.Nu developerI contacted the v.Nu developers by creating an issue in GitHub,"[Specific release .zip, or just readme text, for using v.Nu RELAX NG schemas in XMLeditors?](https://github.com/validator/validator/issues/251)".That issue prompted some comments from the currently most active v.Nu developer,sideshowbarker. For example:> I understand what you want and why but I don't plan to provide myself from thisrepo/project a .zip release with the relaxng files,nor a readme on how to use the files outside the context of the checker.and in response to my question "is this repo the primary public source for thelatest XHTML5 schema?":> Yes. It's actually the only canonical source for the XHTML5 schema.(This is an extract from the response. For the original question andcomplete response, see the [GitHub issue](https://github.com/validator/validator/issues/251).)That correspondence was extremely helpful, and motivated me to do further research.### Correspondence with a jEdit XML plugin developerI knew that the v.Nu schemas refer to a [datatype library](http://www.thaiopensource.com/relaxng/pluggable-datatypes.html):    datatypes w = "http://whattf.org/datatype-draft"To use the schemas, jEdit would need these datatypes.I knew that jEdit and v.Nu use the same RELAX NG validator,[Jing](http://www.thaiopensource.com/relaxng/jing.html).I attempted but failed to transplant the related code from v.Nu to jEdit myself,so I asked for help.I sent the jEdit-users mailing list an email with the subject"Validating XHTML5: how do I add the custom datatypes from the Nu Html Checker (v.Nu)?".That email prompted a[thread of correspondence](https://sourceforge.net/p/jedit/mailman/jedit-users/thread/20160227221940.29fa09cb%40users.sourceforge.net/)with Eric Le Lay, a jEdit XML plugin developer.As of early March 2016, Eric has developed and shared with mea pre-release version of the jEdit XML plugin that includes this datatype library.I've been using that pre-release plugin with the v.Nu schemas to editXHTML5 documents in jEdit.### Source or distribution schemas: which to use?At first, I downloaded the `.rnc` schema files from the v.Nu GitHub repo `schema`directory. I noted that the `schema/.drivers/xhtml5.rnc` file contained areference to a file that did not exist in the repo:    include "html5/xhtml5full-xhtml.rnc"but I decided to worry about that later,and point jEdit instead to `schema/html5/xhtml5.rnc`.That worked - jEdit performed as-you-type validation of XHTML5 - but only up toa point. The schema did not encompass the full set of XHTML5 markup. For example,the schema did not define `role` attributes.That prompted me to perform a more detailed analysis of the[differences](#source-schemas-versus-distributed-schemas)between the source and distribution schemas,and also to request a[change](https://github.com/validator/validator/issues/251#issuecomment-192194725)to the `schema/html5/xhtml5.rnc` file.## The presentI'm using the v.Nu schemas, via a `github.io` URL, with a pre-release versionof the jEdit XML plugin to edit XHTML5 documents. I'm pretty happy about that.For me, this is a big step forward from using the XHTML 1.0 DTD in jEdit.I wonder how many people are aware that they can refer to the v.Nu schemas via`github.io` URLs, without either extracting the distributed schemas from`vnu.jar` (which involves some effort) or downloading a local snapshot of thesource schemas from the GitHub repository.## The near futureTo do:- Investigate doing the same thing - referring to the v.Nu XHTML5 schema via a`github.io` URL, and adding the prerequisitedatatype library - in other tools, including Emacs.- Add one or more schemas (`.rnc` files) to this repo,containing `include` directives that refer to v.Nu `github.io` URLs. These schemas will be for combinations of vocabularies, such as "XHTML5 + SVG + MathML",that are provided by v.Nu, but - due to differences between the directorystructure or contents of the source schemas in the repo and the distributedschemas in `vnu.jar` -are not directly accessible via a single, specific `github.io` URL.The schemas in this repo (`unsoup/validator`) will fill that gap,at least until the developers of v.Nu decide to fill it (if they ever choose to do so). I've chosen to name this repo `validator` so that the only differencebetween the `github.io` URLs to the "Unsoup" schemas and the v.Nu schemas will bethe organization name: `unsoup` versus `validator`. That way, if the v.Nudevelopers do make these "combination" schemas available via the v.Nu repo, allusers will need to do (ideally) is change `unsoup` in their schema URIs to`validator`. However, if the v.Nu developers tell me they'd prefer me to use adifferent repo name, I'll change it, no problem.- Perhaps: submit a post on this subject to the WHATWG blog- Perhaps: add to this repo a script that extracts the distributed schemas from `vnu.jar`## The distant future- Perhaps: develop a browser-based AJAX client for the v.Nu web service API?- An improbable dream: host a variety of free tools under this Unsoup GitHub organization, served via `github.io`,such as an entirely client-side browser-based validating XHTML5 editor that uses the v.Nu schemas. I've already seen someprojects that I could use, or fork as a starting point.## v.Nu does morev.Nu doesn't just validate with these RELAX NG schemas. It also uses Schematron.## A repeat of W3C's excessive DTD traffic?I like the idea of referring to the "living" v.Nu schemas via a URL rather than periodically downloading a snapshot.But there are pros and cons.The standard is largely stable in many areas.And, while I think the amount of network traffic generated by jEdit users(and any other users of these `github.io` URLs) will be small by comparison, I don't want to prompt a repeat of[W3C's excessive DTD traffic](https://www.w3.org/blog/systeam/2008/02/08/w3c_s_excessive_dtd_traffic/)back in the noughties.## Getting the v.Nu schemasHere are some ways to get the schemas from v.Nu:- Extract the schemas distributed in `vnu.jar`- Get the schemas from the v.Nu GitHub repository(these are the source files for `vnu.jar`)There are [differences](#source-schemas-versus-distributed-schemas)between the source and distributed versions of the schemas.## Referring to the v.Nu schemas via `github.io` URLs (GitHub Pages)Files in the `gh-pages` branch of a GitHub repository are availablevia [GitHub Pages](https://pages.github.com/).## Source schemas versus distributed schemasThere are differences between the source schema files in the following v.NuGitHub repository directory:https://github.com/validator/validator/tree/master/schema/and the schemas distributed in the following directory in `vnu.jar`:`nu/validator/localentities/files/`The differences are caused by the v.Nu Python build script, `build.py`.While most of the schemas are identical, there are differences indirectory structure, file contents, and file presence.Independent of those differences, another difference is introduced by how theschema files are packaged in the `.jar`.### How the schemas are packaged for distributionSchema files are stored in the v.Nu GitHub repository in a nested directorystructure under the `schema` directory. For example:`schema/html5/block.rnc`However, the distributed schemas are packaged in the `.jar` without file extensionsin the single flat directory `files`, along with other files that are not schemas.The source schema file cited in the previous example is packaged in the `files`directory as:`schema_html5_block_rnc``build.py` joins the directory path, name, and extension into anunderscore-delimited, extension-less file name.The `files` directory also contains an `entitymap` file that v.Nu uses, via anentity resolver, to map these file names to URIs. For example, here is a linefrom `entitymap`:    http://s.validator.nu/html5/block.rnc	schema_html5_block_rncTo compare the source and distributed schemas:1. Use the `entitymap` as the basis for a script that renames and copies thedistributed schema files from the `.jar` to a directory stucture on your local file system thatmatches the `http://s.validator.nu/` URI paths. For example, a script that renames andcopies `schema_html5_block_rnc` to `schema/html5/block.rnc`.2. Download the `schema` directory from the v.Nu GitHub repository. **Tip:** For a "cleaner" comparison, movethe `html5`, `its2`, `mml3`, and `svg11` subdirectories under the `.drivers`directory. The resulting structure is a better match for the URI paths in the `entitymap`.3. Compare the root directory of the files you extracted from the `.jar` with thesource `.drivers` directory.## Example: using jEdit to validate XHTML5In addition to installing a pre-release XML plugin that contains the required datatype library,I have (following advice from Eric) inserted the following elements in the `schemas.xml`file in my jEdit settings directory (on Windows 7: `%APPDATA%\jEdit\plugins\xml.XmlPlugin\`):    <uri pattern="*.xhtml" typeId="XHTML5"/>    <typeId id="XHTML5" uri="http://validator.github.io/validator/schema/html5/xhtml5.rnc"/>    ## What does *unsoup* mean?The word *unsoup* is - at least, in this context - my own coinage.Unsoup is a [Newspeak](https://en.wikipedia.org/wiki/Newspeak)word that can be used either as a verb or as a noun.As a verb, it means "to convert tag soup into *conformant* markup" (oops, I nearly wrote *valid*).As a noun, it means "conformant markup", as in: a valid(d'oh! I can't help myself :smile:) XHTML5 document.I coined unsoup as a humorous yet respectful nod to the Newspeak-laced interview"[HTML5 - Check it Before you Wreck it with Mike\[tm\] Smith](http://html5doctor.com/html5-check-it-before-you-wreck-it-with-miketm-smith/)"(HTML5 Doctor, 9 December 2014).## AcknowledgmentsSincere thanks to the following people:- Eric Le Lay (jEdit XML plugin developer), for adding the datatype library to the jEdit XML plugin and adviceon how to refer to the v.Nu schema URIs in jEdit.- [sideshowbarker](https://github.com/sideshowbarker) (The Nu Html Checker member), for helpful and clear feedback, and for updating `xhtml5.rnc`with additional `include` directives.